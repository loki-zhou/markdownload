# 锚点链接转换修复需求文档

## 介绍

当前 MarkDownload 扩展在转换网页内容为 Markdown 时，存在锚点链接转换错误的问题。具体表现为页面内的锚点链接（如 `#section-name`）被错误地转换为指向扩展内部 offscreen 页面的绝对链接，而不是保持正确的相对锚点格式。

这个问题影响了转换后 Markdown 文件的可用性，特别是在 GitHub 等平台上，锚点链接是重要的导航功能。

## 需求

### 需求 1

**用户故事：** 作为一个使用 MarkDownload 的用户，我希望页面内的锚点链接能够正确转换，以便在转换后的 Markdown 文件中保持正确的导航功能。

#### 验收标准

1. WHEN 用户转换包含锚点链接的网页 THEN 系统 SHALL 保持锚点链接的相对格式（如 `#section-name`）
2. WHEN 遇到指向页面内部锚点的链接 THEN 系统 SHALL NOT 将其转换为绝对 URL
3. WHEN 转换完成后 THEN 锚点链接 SHALL 在 Markdown 文件中正常工作

### 需求 2

**用户故事：** 作为开发者，我希望链接处理逻辑能够正确区分不同类型的链接，以确保各种链接都能得到适当的处理。

#### 验收标准

1. WHEN 系统处理链接时 THEN 系统 SHALL 正确识别锚点链接（以 `#` 开头）
2. WHEN 系统处理链接时 THEN 系统 SHALL 正确识别相对链接
3. WHEN 系统处理链接时 THEN 系统 SHALL 正确识别绝对链接
4. WHEN 系统处理不同类型的链接时 THEN 每种类型 SHALL 得到相应的正确处理

### 需求 3

**用户故事：** 作为质量保证人员，我希望修复后的功能能够通过全面测试，确保不会影响其他链接类型的正常转换。

#### 验收标准

1. WHEN 修复实施后 THEN 外部链接转换 SHALL 保持正常工作
2. WHEN 修复实施后 THEN 相对路径链接转换 SHALL 保持正常工作  
3. WHEN 修复实施后 THEN 图片链接处理 SHALL 保持正常工作
4. WHEN 进行回归测试时 THEN 所有现有功能 SHALL 保持稳定运行

### 需求 4

**用户故事：** 作为用户，我希望修复能够处理各种复杂的锚点链接场景，包括带有特殊字符和多语言内容的锚点。

#### 验收标准

1. WHEN 锚点包含中文字符时 THEN 系统 SHALL 正确处理编码和转换
2. WHEN 锚点包含特殊字符时 THEN 系统 SHALL 保持字符的正确性
3. WHEN 锚点链接在复杂 HTML 结构中时 THEN 系统 SHALL 准确识别和转换
4. WHEN 页面包含多个同类型锚点时 THEN 每个锚点 SHALL 独立正确处理